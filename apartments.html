<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apartments in Rome ‚Äî BOOM</title>
    <meta name="description" content="Browse video-verified apartments for rent in Rome. Updated daily. No hidden fees. Move in within 48 hours.">
    <link rel="icon" type="image/png" href="https://www.boomrome.com/BOOMlogogoldicon512.png">
    <link rel="apple-touch-icon" href="https://www.boomrome.com/BOOMlogogoldicon512.png">
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-EYCD59RDVJ"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-EYCD59RDVJ');</script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@200;300;400;500;600&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--gold:#FFD700;--pure-black:#000;--dark-void:#0A0A0A;--text-primary:#fff;--text-secondary:rgba(255,255,255,0.7);--text-fade:rgba(255,255,255,0.4)}
        body{font-family:'Inter',-apple-system,sans-serif;background:var(--pure-black);color:var(--text-primary);font-weight:300;line-height:1.6;-webkit-font-smoothing:antialiased}
        a{text-decoration:none;color:inherit}

        /* NAV */
        nav{position:fixed;width:100%;top:0;z-index:100;padding:20px 50px;background:rgba(0,0,0,0.98);backdrop-filter:blur(20px);border-bottom:1px solid rgba(255,215,0,0.1)}
        .nav-container{max-width:1400px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}
        .logo{display:flex;align-items:center;gap:15px;text-decoration:none;color:#fff}
        .logo-svg{width:80px;height:80px;filter:drop-shadow(0 0 20px rgba(255,215,0,0.5));transition:filter .3s}
        .logo:hover .logo-svg{filter:drop-shadow(0 0 35px rgba(255,215,0,0.8))}
        .logo-text{font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;font-size:32px;font-weight:300;letter-spacing:4px;text-transform:uppercase}
        .nav-links{display:flex;gap:30px;align-items:center}
        .nav-links a{color:rgba(255,255,255,0.6);text-decoration:none;font-size:13px;font-weight:300;text-transform:uppercase;letter-spacing:1px;transition:color .3s}
        .nav-links a:hover,.nav-links a.active{color:var(--gold)}
        .wa-link{color:#25D366!important}
        .hamburger{display:none;flex-direction:column;gap:5px;cursor:pointer;padding:10px;z-index:101}
        .hamburger span{display:block;width:24px;height:2px;background:#fff;transition:.3s}
        @media(max-width:768px){
            nav{padding:15px 20px}
            .nav-links{display:none}
            .hamburger{display:flex}
            .logo-svg{width:50px;height:50px}
            .logo-text{font-size:22px;letter-spacing:3px}
        }
        .mobile-menu{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.98);z-index:99;display:none;flex-direction:column;justify-content:center;align-items:center;gap:28px}
        .mobile-menu.open{display:flex}
        .mobile-menu a{color:rgba(255,255,255,0.6);font-size:18px;font-weight:300;text-transform:uppercase;letter-spacing:2px;transition:color .3s}
        .mobile-menu a:hover{color:var(--gold)}
        .wa-mob{color:#25D366!important;border:1px solid #25D366;padding:12px 28px;border-radius:30px;margin-top:10px}

        /* PAGE */
        .page{max-width:1400px;margin:0 auto;padding:140px 40px 80px}
        @media(max-width:768px){.page{padding:120px 20px 60px}}

        .page-header{text-align:center;margin-bottom:50px}
        .page-tag{display:inline-block;font-size:11px;text-transform:uppercase;letter-spacing:3px;color:var(--gold);margin-bottom:12px}
        .page-title{font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;font-size:clamp(32px,5vw,56px);font-weight:200;line-height:1.1;margin-bottom:16px}
        .page-subtitle{font-size:16px;color:var(--text-secondary);max-width:600px;margin:0 auto}

        /* FILTERS */
        .filters{display:flex;justify-content:center;gap:12px;margin-bottom:40px;flex-wrap:wrap}
        .filter-btn{padding:10px 24px;border-radius:30px;border:1px solid rgba(255,255,255,0.1);background:transparent;color:var(--text-secondary);font-family:inherit;font-size:13px;font-weight:400;cursor:pointer;transition:all .3s}
        .filter-btn:hover{border-color:rgba(255,215,0,0.3);color:var(--text-primary)}
        .filter-btn.active{background:var(--gold);color:#000;border-color:var(--gold);font-weight:600}
        .filter-count{margin-left:6px;opacity:.6}

        /* GRID */
        .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(340px,1fr));gap:24px}
        @media(max-width:768px){.grid{grid-template-columns:1fr;gap:20px}}

        /* CARD */
        .card{background:var(--dark-void);border:1px solid rgba(255,255,255,0.06);border-radius:20px;overflow:hidden;transition:all .4s;cursor:pointer;display:flex;flex-direction:column}
        .card:hover{transform:translateY(-4px);border-color:rgba(255,215,0,0.15);box-shadow:0 20px 60px rgba(0,0,0,0.5)}
        .card-img{width:100%;height:220px;background-size:cover;background-position:center;background-color:#111;position:relative}
        .card-badges{position:absolute;top:14px;left:14px;display:flex;gap:8px;flex-wrap:wrap}
        .badge{padding:5px 12px;border-radius:20px;font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;backdrop-filter:blur(10px)}
        .badge-available{background:rgba(0,255,136,0.15);color:#00FF88;border:1px solid rgba(0,255,136,0.2)}
        .badge-waitlist{background:rgba(255,149,0,0.15);color:#FF9500;border:1px solid rgba(255,149,0,0.2)}
        .badge-verified{background:rgba(255,255,255,0.08);color:rgba(255,255,255,0.7);border:1px solid rgba(255,255,255,0.1)}
        .badge-video{background:rgba(255,59,48,0.15);color:#FF3B30;border:1px solid rgba(255,59,48,0.2)}
        .card-body{padding:22px 24px 24px;flex:1;display:flex;flex-direction:column}
        .card-zone{font-size:11px;text-transform:uppercase;letter-spacing:2px;color:var(--gold);margin-bottom:6px}
        .card-name{font-size:20px;font-weight:400;margin-bottom:10px;color:#fff}
        .card-specs{display:flex;gap:16px;font-size:13px;color:var(--text-secondary);margin-bottom:16px;flex-wrap:wrap}
        .card-specs span{display:flex;align-items:center;gap:5px}
        .card-tags{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px}
        .card-tag{padding:4px 10px;border-radius:6px;font-size:10px;background:rgba(255,255,255,0.04);color:var(--text-fade);border:1px solid rgba(255,255,255,0.04)}
        .card-bottom{display:flex;justify-content:space-between;align-items:center;margin-top:auto;padding-top:16px;border-top:1px solid rgba(255,255,255,0.06)}
        .card-price{font-size:24px;font-weight:200;color:var(--gold)}
        .card-price small{font-size:12px;color:var(--text-fade);font-weight:300}
        .card-cta{padding:10px 20px;border-radius:10px;font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;background:rgba(255,255,255,0.06);color:var(--text-secondary);transition:all .3s;border:1px solid rgba(255,255,255,0.06)}
        .card:hover .card-cta{background:var(--gold);color:#000;border-color:var(--gold)}
        .card-avail{font-size:11px;color:var(--text-fade);margin-top:8px}

        /* LOADING / EMPTY */
        .loading-state{text-align:center;padding:80px 20px}
        .spinner{width:40px;height:40px;border:3px solid rgba(255,255,255,0.1);border-top-color:var(--gold);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 20px}
        @keyframes spin{to{transform:rotate(360deg)}}
        .empty-state{text-align:center;padding:80px 20px}
        .empty-state h3{font-size:24px;font-weight:200;margin-bottom:12px}
        .empty-state p{color:var(--text-secondary);margin-bottom:24px}

        /* UPSELL SECTION */
        .upsell-section{margin-top:80px}
        .upsell-header{text-align:center;margin-bottom:48px}
        .upsell-tag{display:inline-block;padding:8px 20px;background:var(--gold);color:#000;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;margin-bottom:20px}
        .upsell-title{font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;font-size:clamp(26px,4vw,44px);font-weight:200;margin-bottom:12px}
        .upsell-subtitle{font-size:15px;color:var(--text-secondary);max-width:520px;margin:0 auto;line-height:1.6}

        .notify-banner{background:linear-gradient(135deg,rgba(255,215,0,0.05) 0%,rgba(0,206,209,0.04) 100%);border:1px solid rgba(255,215,0,0.12);border-radius:20px;padding:32px 36px;margin-bottom:32px;display:flex;align-items:center;gap:28px;transition:border-color .3s}
        .notify-banner:hover{border-color:rgba(255,215,0,0.25)}
        .notify-icon{width:56px;height:56px;background:rgba(255,215,0,0.08);border-radius:16px;display:flex;align-items:center;justify-content:center;font-size:24px;flex-shrink:0}
        .notify-text{flex:1}
        .notify-text h3{font-size:17px;font-weight:500;margin-bottom:4px}
        .notify-text p{font-size:13px;color:var(--text-secondary);line-height:1.5}
        .notify-actions{display:flex;gap:10px;flex-shrink:0}
        .notify-actions .nbtn{padding:12px 24px;border-radius:10px;font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;transition:all .3s;text-decoration:none;display:inline-flex;align-items:center;gap:8px;white-space:nowrap;border:none}
        .nbtn-primary{background:var(--gold);color:#000}
        .nbtn-primary:hover{box-shadow:0 6px 24px rgba(255,215,0,0.25);transform:translateY(-1px)}
        .nbtn-wa{background:#25D366;color:#fff}
        .nbtn-wa:hover{box-shadow:0 6px 24px rgba(37,211,102,0.25);transform:translateY(-1px)}
        @media(max-width:900px){.notify-banner{flex-direction:column;text-align:center;gap:18px;padding:28px 24px}.notify-actions{width:100%;flex-direction:column}.notify-actions .nbtn{justify-content:center}}

        .services-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}
        @media(max-width:1024px){.services-grid{grid-template-columns:1fr}}
        .svc-card{position:relative;background:var(--dark-void);border:1px solid rgba(255,255,255,0.05);border-radius:20px;overflow:hidden;transition:all .4s;display:flex;flex-direction:column}
        .svc-card:hover{transform:translateY(-5px);box-shadow:0 20px 50px rgba(0,0,0,0.4)}
        .svc-card.featured{border-color:rgba(255,215,0,0.15)}
        .svc-card.featured:hover{border-color:rgba(255,215,0,0.35)}
        .svc-popular{position:absolute;top:0;left:0;right:0;padding:6px;text-align:center;background:var(--gold);color:#000;font-size:10px;font-weight:800;letter-spacing:1.5px;text-transform:uppercase}
        .svc-top{padding:32px 28px 0;flex:1}
        .svc-card.featured .svc-top{padding-top:44px}
        .svc-badge{display:inline-flex;padding:6px 14px;border-radius:8px;font-size:10px;font-weight:700;letter-spacing:.5px;text-transform:uppercase;margin-bottom:14px}
        .svc-badge-pfs{background:rgba(255,215,0,0.1);color:var(--gold)}
        .svc-badge-das{background:rgba(0,206,209,0.1);color:#00CED1}
        .svc-badge-vv{background:rgba(255,107,107,0.1);color:#FF6B6B}
        .svc-card h3{font-size:20px;font-weight:400;margin-bottom:6px}
        .svc-card .desc{font-size:13px;color:var(--text-secondary);line-height:1.6;margin-bottom:18px}
        .svc-price{display:flex;align-items:baseline;gap:8px;margin-bottom:18px}
        .svc-price strong{font-size:28px;font-weight:200;color:var(--gold)}
        .svc-price span{font-size:12px;color:var(--text-fade)}
        .svc-features{list-style:none;padding:0;margin:0}
        .svc-features li{display:flex;gap:10px;padding:5px 0;font-size:13px;color:var(--text-secondary)}
        .svc-features li::before{content:'‚úì';color:var(--gold);font-weight:700;flex-shrink:0}
        .svc-bottom{padding:20px 28px;border-top:1px solid rgba(255,255,255,0.04);margin-top:auto}
        .svc-cta{display:block;text-align:center;padding:14px;border-radius:12px;font-size:14px;font-weight:600;text-decoration:none;transition:all .3s}
        .svc-cta-gold{background:var(--gold);color:#000}
        .svc-cta-gold:hover{box-shadow:0 8px 30px rgba(255,215,0,0.3)}
        .svc-cta-outline{background:transparent;border:1px solid rgba(255,255,255,0.1);color:var(--text-secondary)}
        .svc-cta-outline:hover{border-color:var(--gold);color:var(--gold)}

        /* FOOTER */
        footer{background:var(--dark-void);border-top:1px solid rgba(255,255,255,0.05);padding:60px 40px 30px}
        .footer-content{max-width:1400px;margin:0 auto;display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:40px}
        @media(max-width:768px){.footer-content{grid-template-columns:1fr;gap:30px}footer{padding:40px 20px 20px}}
        .footer-brand h3{font-family:'Helvetica Neue',Helvetica,Arial,sans-serif;font-size:24px;font-weight:300;letter-spacing:4px;margin-bottom:12px}
        .footer-brand p{font-size:13px;color:var(--text-fade);line-height:1.8}
        .footer-col h4{font-size:11px;text-transform:uppercase;letter-spacing:2px;color:var(--text-secondary);margin-bottom:16px}
        .footer-col a{display:block;font-size:13px;color:var(--text-fade);margin-bottom:10px;transition:color .3s}
        .footer-col a:hover{color:var(--gold)}
        .footer-bottom{max-width:1400px;margin:30px auto 0;padding-top:20px;border-top:1px solid rgba(255,255,255,0.05);text-align:center;font-size:12px;color:var(--text-fade)}
    </style>
</head>
<body>

    <!-- NAV -->
    <nav>
        <div class="nav-container">
            <a href="/" class="logo">
                <img src="https://www.boomrome.com/BOOMlogogoldicon512.png" alt="BOOM" class="logo-svg">
                <span class="logo-text">BOOM</span>
            </a>
            <div class="nav-links">
                <a href="/apartments.html" class="active">Apartments</a>
                <a href="/property-finding.html">Property Finding</a>
                <a href="/deal-assistance.html">Deal Assistance</a>
                <a href="/virtual-viewing.html">Virtual Viewing</a>
                <a href="/concierge.html">Concierge</a>
                <a href="/about.html">About</a>
                <a href="https://wa.me/393313251961" class="wa-link">WhatsApp</a>
            </div>
            <div class="hamburger" id="hamburger"><span></span><span></span><span></span></div>
        </div>
    </nav>

    <div class="mobile-menu" id="mobileMenu">
        <a href="/">Home</a>
        <a href="/apartments.html">Apartments</a>
        <a href="/property-finding.html">Property Finding</a>
        <a href="/deal-assistance.html">Deal Assistance</a>
        <a href="/virtual-viewing.html">Virtual Viewing</a>
        <a href="/concierge.html">Concierge</a>
        <a href="/about.html">About</a>
        <a href="/login.html">Login</a>
        <a href="https://wa.me/393313251961" class="wa-mob">WhatsApp Us</a>
    </div>

    <div class="page">
        <div class="page-header">
            <div class="page-tag">Available Now</div>
            <h1 class="page-title">Apartments in Rome</h1>
            <p class="page-subtitle">All verified. All real. All ready. Updated daily from our portfolio.</p>
        </div>

        <div class="filters" id="filters">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="available">Available</button>
            <button class="filter-btn" data-filter="waitlist">Coming Soon</button>
        </div>

        <div id="listingsContainer">
            <div class="loading-state" id="loadingState">
                <div class="spinner"></div>
                <p style="color:var(--text-secondary)">Loading apartments‚Ä¶</p>
            </div>
        </div>

        <!-- UPSELL SECTION -->
        <div class="upsell-section">
            <div class="upsell-header">
                <span class="upsell-tag">How Can We Help</span>
                <h2 class="upsell-title">Not finding what you need?</h2>
                <p class="upsell-subtitle">Whether you need us to find, verify, or negotiate ‚Äî we've got the right service for every stage of your search.</p>
            </div>

            <div class="notify-banner">
                <div class="notify-icon">üîî</div>
                <div class="notify-text">
                    <h3>Get Notified When We Find a Match</h3>
                    <p>Tell us your requirements ‚Äî budget, zone, move-in date ‚Äî and we'll reach out when something fits. No commitment, no spam.</p>
                </div>
                <div class="notify-actions">
                    <a href="https://wa.me/393313251961?text=Hi%20BOOM%2C%20I%27m%20looking%20for%20an%20apartment%20in%20Rome.%20Here%20are%20my%20requirements%3A%0A%0ABudget%3A%20%0AZone%3A%20%0AMove-in%3A%20%0ABedrooms%3A%20" class="nbtn nbtn-wa" target="_blank">üí¨ WhatsApp Us</a>
                    <a href="/property-finding.html#onboarding" class="nbtn nbtn-primary">üìã Fill the Form</a>
                </div>
            </div>

            <div class="services-grid">
                <div class="svc-card featured">
                    <div class="svc-popular">Most Popular</div>
                    <div class="svc-top">
                        <span class="svc-badge svc-badge-pfs">üîç Full Search</span>
                        <h3>Property Finding</h3>
                        <p class="desc">We search the entire Rome market for you ‚Äî portals, off-market, landlord network. Curated shortlist within 10 days.</p>
                        <div class="svc-price"><strong>‚Ç¨350</strong><span>upfront ¬∑ deducted from agency fee</span></div>
                        <ul class="svc-features">
                            <li>Dedicated agent searching for you</li>
                            <li>Access to off-market properties</li>
                            <li>Curated shortlist in 10 days</li>
                            <li>Video tour of every option</li>
                            <li>Full refund if we don't deliver</li>
                        </ul>
                    </div>
                    <div class="svc-bottom"><a href="/property-finding.html" class="svc-cta svc-cta-gold">Start Property Finding ‚Üí</a></div>
                </div>

                <div class="svc-card">
                    <div class="svc-top">
                        <span class="svc-badge svc-badge-das">ü§ù Contract Help</span>
                        <h3>Deal Assistance</h3>
                        <p class="desc">Found a place yourself? We review the contract, verify the landlord, negotiate terms, and protect you from scams.</p>
                        <div class="svc-price"><strong>‚Ç¨249</strong><span>fixed fee ¬∑ no surprises</span></div>
                        <ul class="svc-features">
                            <li>Contract review &amp; translation</li>
                            <li>Landlord &amp; property verification</li>
                            <li>Price &amp; terms negotiation</li>
                            <li>Red flag identification</li>
                            <li>Deposit protection advice</li>
                        </ul>
                    </div>
                    <div class="svc-bottom"><a href="/deal-assistance.html" class="svc-cta svc-cta-outline">Learn More ‚Üí</a></div>
                </div>

                <div class="svc-card">
                    <div class="svc-top">
                        <span class="svc-badge svc-badge-vv">üìπ Remote Viewing</span>
                        <h3>Virtual Viewing</h3>
                        <p class="desc">Can't visit in person? We go for you ‚Äî live HD video walkthrough with real-time Q&amp;A and an honest assessment report.</p>
                        <div class="svc-price"><strong>‚Ç¨89</strong><span>per viewing ¬∑ from abroad</span></div>
                        <ul class="svc-features">
                            <li>Live HD video walkthrough</li>
                            <li>Real-time Q&amp;A with our agent</li>
                            <li>Neighborhood &amp; building check</li>
                            <li>Detailed written report</li>
                            <li>Honest go / no-go recommendation</li>
                        </ul>
                    </div>
                    <div class="svc-bottom"><a href="/virtual-viewing.html" class="svc-cta svc-cta-outline">Learn More ‚Üí</a></div>
                </div>
            </div>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <div class="footer-content">
            <div class="footer-brand">
                <h3>BOOM</h3>
                <p>Built in Rome, for Rome. If we can make Rome's rental market work, we can make it work anywhere.</p>
                <p style="margin-top:12px"><strong>Egidi Immobiliare S.r.l.</strong><br>P.IVA 17322991005<br>REA RM - 1710623<br>Rome, Italy</p>
            </div>
            <div class="footer-col">
                <h4>Services</h4>
                <a href="/apartments.html">Apartments</a>
                <a href="/property-finding.html">Property Finding</a>
                <a href="/deal-assistance.html">Deal Assistance</a>
                <a href="/virtual-viewing.html">Virtual Viewing</a>
                <a href="/concierge.html">Concierge</a>
            </div>
            <div class="footer-col">
                <h4>Company</h4>
                <a href="/about.html">About</a>
                <a href="/how-it-works.html">How It Works</a>
                <a href="/owners.html">For Owners</a>
                <a href="/blog.html">Blog</a>
                <a href="/faq.html">FAQ</a>
                <a href="/contact.html">Contact</a>
            </div>
            <div class="footer-col">
                <h4>Legal</h4>
                <a href="/terms.html">Terms</a>
                <a href="/privacy.html">Privacy</a>
                <a href="/login.html">Login</a>
            </div>
        </div>
        <div class="footer-bottom">¬© 2025 BOOM ‚Äî All Rights Reserved</div>
    </footer>

    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <script>
    // Same Firebase project as portal.html (boom-property-dashboards)
    firebase.initializeApp({
        apiKey:"AIzaSyDDb8UeSc8RhO_VxQrhLrupu1aPD4rwRso",
        authDomain:"boom-property-dashboards.firebaseapp.com",
        projectId:"boom-property-dashboards",
        storageBucket:"boom-property-dashboards.firebasestorage.app",
        messagingSenderId:"937269017440",
        appId:"1:937269017440:web:41c1a0b1e1633c2f373c05"
    });
    const db = firebase.firestore();

    let allListings = [];
    let currentFilter = 'all';

    // Hamburger
    document.getElementById('hamburger').addEventListener('click', () => {
        document.getElementById('mobileMenu').classList.toggle('open');
    });
    document.querySelectorAll('.mobile-menu a').forEach(a => {
        a.addEventListener('click', () => document.getElementById('mobileMenu').classList.remove('open'));
    });

    // Filters
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilter = btn.dataset.filter;
            renderListings();
        });
    });

    // Load listings from Firebase
    async function loadListings() {
        try {
            const snapshot = await db.collection('listings').get();
            allListings = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            
            // Update filter counts
            const available = allListings.filter(l => l.status === 'available').length;
            const waitlist = allListings.filter(l => l.status === 'waitlist').length;
            const visible = available + waitlist;
            
            document.querySelectorAll('.filter-btn').forEach(btn => {
                const f = btn.dataset.filter;
                let count = 0;
                if (f === 'all') count = visible;
                else if (f === 'available') count = available;
                else if (f === 'waitlist') count = waitlist;
                // Add count badge
                const existing = btn.querySelector('.filter-count');
                if (existing) existing.remove();
                if (count > 0) {
                    const span = document.createElement('span');
                    span.className = 'filter-count';
                    span.textContent = count;
                    btn.appendChild(span);
                }
            });

            renderListings();
        } catch (err) {
            console.error('Error loading listings:', err);
            document.getElementById('listingsContainer').innerHTML = `
                <div class="empty-state">
                    <h3>Connection Error</h3>
                    <p>Could not load apartments. Please refresh the page.</p>
                </div>`;
        }
    }

    function renderListings() {
        const container = document.getElementById('listingsContainer');
        
        // Filter: hide rented, show available + waitlist
        let filtered = allListings.filter(l => l.status === 'available' || l.status === 'waitlist');
        
        if (currentFilter === 'available') {
            filtered = filtered.filter(l => l.status === 'available');
        } else if (currentFilter === 'waitlist') {
            filtered = filtered.filter(l => l.status === 'waitlist');
        }

        // Sort: available first, then by price ascending
        filtered.sort((a, b) => {
            if (a.status === 'available' && b.status !== 'available') return -1;
            if (a.status !== 'available' && b.status === 'available') return 1;
            return (a.price || 0) - (b.price || 0);
        });

        if (filtered.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <h3>No apartments available right now</h3>
                    <p>New listings are added frequently. Try our Property Finding Service and we'll search for you.</p>
                    <a href="/property-finding.html" style="display:inline-block;margin-top:16px;padding:14px 32px;background:var(--gold);color:#000;border-radius:12px;font-weight:600;font-size:14px">Start Property Finding ‚Üí</a>
                </div>`;
            return;
        }

        container.innerHTML = `<div class="grid">${filtered.map(l => cardHTML(l)).join('')}</div>`;
    }

    function cardHTML(l) {
        const imgUrl = l.image || 'https://via.placeholder.com/400x220/111111/333333?text=Photo+Coming+Soon';
        const beds = l.beds || (l.bedrooms ? (l.bedrooms === 0 ? 'Studio' : l.bedrooms + ' Bed') : '');
        const sqm = l.size || (l.sqm ? l.sqm + 'm¬≤' : '');
        const price = l.price ? `‚Ç¨${Number(l.price).toLocaleString()}` : '‚Äî';
        
        // Determine link: use l.file if set, otherwise apartment-detail.html?id=
        let link = l.file || `apartment-detail.html?id=${l.id}`;
        if (link && !link.startsWith('http') && !link.startsWith('/')) link = '/' + link;
        
        const statusBadge = l.status === 'available' 
            ? '<span class="badge badge-available">Available</span>' 
            : '<span class="badge badge-waitlist">Coming Soon</span>';
        
        const verifiedBadge = '<span class="badge badge-verified">‚úì Verified</span>';
        const videoBadge = l.videoUrl ? '<span class="badge badge-video">‚ñ∂ Video</span>' : '';
        
        // Tags (max 3)
        const tags = Array.isArray(l.tags) ? l.tags.slice(0, 3) : [];
        const tagsHTML = tags.length ? `<div class="card-tags">${tags.map(t => `<span class="card-tag">${t}</span>`).join('')}</div>` : '';
        
        // Specs
        const specs = [];
        if (beds) specs.push(`<span>üõèÔ∏è ${beds}</span>`);
        if (sqm) specs.push(`<span>üìê ${sqm}</span>`);
        if (l.floor) specs.push(`<span>üè¢ ${l.floor}</span>`);
        if (l.type) specs.push(`<span>${l.type}</span>`);
        
        const availDate = l.availableDate ? `<div class="card-avail">Available: ${l.availableDate}</div>` : '';

        return `<a href="${link}" class="card">
            <div class="card-img" style="background-image:url('${imgUrl}')">
                <div class="card-badges">${statusBadge}${verifiedBadge}${videoBadge}</div>
            </div>
            <div class="card-body">
                ${l.zone ? `<div class="card-zone">${l.zone}</div>` : ''}
                <div class="card-name">${l.name || 'Apartment'}</div>
                ${specs.length ? `<div class="card-specs">${specs.join('')}</div>` : ''}
                ${tagsHTML}
                <div class="card-bottom">
                    <div class="card-price">${price} <small>/month</small></div>
                    <div class="card-cta">View Details</div>
                </div>
                ${availDate}
            </div>
        </a>`;
    }

    // Init
    loadListings();
    </script>
</body>
</html>
