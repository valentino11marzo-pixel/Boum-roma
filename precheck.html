<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Check Availability – BOOM</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: #fff;
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 680px;
            margin: 0 auto;
            padding: 40px 24px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            margin-bottom: 60px;
            text-align: center;
        }

        .apartment-badge {
            display: inline-block;
            background: rgba(255, 229, 0, 0.1);
            border: 1px solid rgba(255, 229, 0, 0.3);
            color: #FFE500;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .apartment-title {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            line-height: 1.2;
        }

        .apartment-price {
            font-size: 20px;
            color: #888;
        }

        .apartment-price strong {
            color: #FFE500;
            font-weight: 700;
        }

        /* Progress */
        .progress-bar {
            height: 2px;
            background: #222;
            margin-bottom: 60px;
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFE500, #00FFE5);
            width: 0%;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Steps Container */
        .steps {
            flex: 1;
            position: relative;
        }

        .step {
            opacity: 0;
            transform: translateY(30px);
            position: absolute;
            width: 100%;
            pointer-events: none;
            transition: opacity 0.4s ease, transform 0.4s ease;
        }

        .step.active {
            opacity: 1;
            transform: translateY(0);
            position: relative;
            pointer-events: all;
        }

        .step-number {
            color: #666;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .step-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 12px;
            line-height: 1.3;
        }

        .step-subtitle {
            font-size: 17px;
            color: #888;
            margin-bottom: 48px;
            line-height: 1.6;
        }

        /* Inputs */
        .input-group {
            margin-bottom: 24px;
        }

        .input-large {
            width: 100%;
            background: #111;
            border: 2px solid #222;
            color: #fff;
            padding: 20px 24px;
            font-size: 20px;
            border-radius: 12px;
            font-family: inherit;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .input-large:focus {
            outline: none;
            border-color: #FFE500;
            background: #1a1a1a;
        }

        .input-large::placeholder {
            color: #555;
        }

        /* Choice Cards */
        .choices {
            display: grid;
            gap: 16px;
            margin-bottom: 32px;
        }

        .choice-card {
            background: #111;
            border: 2px solid #222;
            border-radius: 12px;
            padding: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .choice-card:hover {
            border-color: #FFE500;
            background: #1a1a1a;
            transform: translateY(-2px);
        }

        .choice-card.selected {
            border-color: #FFE500;
            background: rgba(255, 229, 0, 0.05);
        }

        .choice-card::before {
            content: '';
            position: absolute;
            top: 24px;
            right: 24px;
            width: 20px;
            height: 20px;
            border: 2px solid #333;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .choice-card.selected::before {
            border-color: #FFE500;
            background: #FFE500;
            box-shadow: inset 0 0 0 4px #000;
        }

        .choice-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .choice-desc {
            font-size: 15px;
            color: #888;
            line-height: 1.5;
        }

        .choice-badge {
            display: inline-block;
            background: rgba(57, 255, 20, 0.1);
            color: #39FF14;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 13px;
            font-weight: 600;
            margin-top: 8px;
        }

        .choice-price {
            color: #FFE500;
            font-size: 16px;
            font-weight: 700;
            margin-top: 12px;
        }

        /* Two Column */
        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }

        /* Checkboxes */
        .checkbox-item {
            background: #111;
            border: 2px solid #222;
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .checkbox-item:hover {
            border-color: #FFE500;
        }

        .checkbox-item.checked {
            border-color: #39FF14;
            background: rgba(57, 255, 20, 0.05);
        }

        .checkbox-custom {
            width: 24px;
            height: 24px;
            border: 2px solid #333;
            border-radius: 6px;
            flex-shrink: 0;
            transition: all 0.3s ease;
            position: relative;
        }

        .checkbox-item.checked .checkbox-custom {
            background: #39FF14;
            border-color: #39FF14;
        }

        .checkbox-item.checked .checkbox-custom::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #000;
            font-weight: 700;
            font-size: 16px;
        }

        .checkbox-label {
            font-size: 16px;
            color: #ccc;
        }

        /* Info Box */
        .info-hint {
            background: rgba(0, 255, 229, 0.05);
            border-left: 3px solid #00FFE5;
            padding: 16px 20px;
            margin: 32px 0;
            font-size: 15px;
            color: #aaa;
            line-height: 1.6;
            border-radius: 4px;
        }

        /* Income Type Sections */
        #ownIncomeSection, #guarantorSection, #upfrontSection {
            animation: fadeSlideIn 0.4s ease;
        }

        @keyframes fadeSlideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Navigation */
        .nav-buttons {
            display: flex;
            gap: 16px;
            margin-top: 48px;
        }

        .btn {
            flex: 1;
            padding: 18px 32px;
            font-size: 17px;
            font-weight: 600;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .btn-primary {
            background: #FFE500;
            color: #000;
        }

        .btn-primary:hover {
            background: #fff;
            transform: translateY(-2px);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: transparent;
            color: #888;
            border: 2px solid #333;
        }

        .btn-secondary:hover {
            border-color: #666;
            color: #fff;
        }

        /* Success Screen */
        .success-screen {
            display: none;
            text-align: center;
            padding: 80px 24px;
            opacity: 0;
            transform: scale(0.9);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .success-screen.active {
            display: block;
            opacity: 1;
            transform: scale(1);
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: #39FF14;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 32px;
            font-size: 48px;
            animation: successPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes successPop {
            0% { transform: scale(0); }
            100% { transform: scale(1); }
        }

        .success-title {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .success-text {
            font-size: 18px;
            color: #888;
            line-height: 1.8;
            max-width: 500px;
            margin: 0 auto 32px;
        }

        .success-email {
            color: #FFE500;
            font-weight: 600;
        }

        .success-time {
            background: rgba(255, 229, 0, 0.1);
            border: 1px solid rgba(255, 229, 0, 0.3);
            color: #FFE500;
            padding: 12px 24px;
            border-radius: 20px;
            font-size: 15px;
            font-weight: 600;
            display: inline-block;
        }

        @media (max-width: 768px) {
            .apartment-title {
                font-size: 24px;
            }

            .step-title {
                font-size: 24px;
            }

            .input-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="apartment-badge" id="apartmentStatus">Available Now</div>
            <h1 class="apartment-title" id="apartmentTitle">Loading...</h1>
            <p class="apartment-price"><strong id="apartmentPrice">€0</strong> / month</p>
        </div>

        <!-- Progress Bar -->
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>

        <!-- WEB3FORMS - HIDDEN FORM (collects all data at the end) -->
        <form id="web3Form" action="https://api.web3forms.com/submit" method="POST" style="display: none;">
            <input type="hidden" name="access_key" value="5b10beba-c7e0-4cd2-98f9-2dbb0aefe889">
            <input type="hidden" name="subject" value="🏠 New BOOM Application">
            <input type="hidden" name="from_name" value="BOOM Platform">
            <input type="checkbox" name="botcheck" style="display: none;">
            
            <!-- All form fields will be added dynamically before submission -->
        </form>

        <!-- Steps -->
        <div class="steps" id="stepsContainer">
            <!-- Step 1: Move-in Date -->
            <div class="step active" data-step="1">
                <div class="step-number">Step 1 of 6</div>
                <h2 class="step-title">When would you like to move in?</h2>
                <p class="step-subtitle">We'll check if the apartment is available for your dates.</p>
                
                <div class="input-group">
                    <input type="date" class="input-large" id="moveInDate" required>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-primary" onclick="nextStep()">Continue</button>
                </div>
            </div>

            <!-- Step 2: Duration -->
            <div class="step" data-step="2">
                <div class="step-number">Step 2 of 6</div>
                <h2 class="step-title">How long do you need it?</h2>
                <p class="step-subtitle">BOOM specializes in 3-24 month rentals.</p>
                
                <div class="choices">
                    <div class="choice-card" onclick="selectChoice(this, 'duration', '3-6')">
                        <div class="choice-title">3-6 months</div>
                        <div class="choice-desc">Perfect for internships or trial periods</div>
                    </div>
                    <div class="choice-card" onclick="selectChoice(this, 'duration', '6-12')">
                        <div class="choice-title">6-12 months</div>
                        <div class="choice-desc">Most popular choice</div>
                    </div>
                    <div class="choice-card" onclick="selectChoice(this, 'duration', '12+')">
                        <div class="choice-title">12+ months</div>
                        <div class="choice-desc">Best negotiation power</div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn btn-primary" onclick="nextStep()" disabled>Continue</button>
                </div>
            </div>

            <!-- Step 3: About You -->
            <div class="step" data-step="3">
                <div class="step-number">Step 3 of 6</div>
                <h2 class="step-title">Tell us about yourself</h2>
                <p class="step-subtitle">Just the basics. We keep it simple.</p>
                
                <div class="input-row">
                    <input type="text" class="input-large" id="firstName" placeholder="First name" required>
                    <input type="text" class="input-large" id="lastName" placeholder="Last name" required>
                </div>
                <div class="input-row">
                    <input type="email" class="input-large" id="email" placeholder="Email" required>
                    <input type="tel" class="input-large" id="phone" placeholder="+39 333 123 4567" required>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn btn-primary" onclick="nextStep()">Continue</button>
                </div>
            </div>

            <!-- Step 4: Work -->
            <div class="step" data-step="4">
                <div class="step-number">Step 4 of 6</div>
                <h2 class="step-title">What do you do?</h2>
                <p class="step-subtitle">Landlords need to know you can pay the rent.</p>
                
                <div class="choices">
                    <div class="choice-card" onclick="selectChoice(this, 'employment', 'employed')">
                        <div class="choice-title">Employed Full-Time</div>
                        <div class="choice-desc">Regular payslips</div>
                    </div>
                    <div class="choice-card" onclick="selectChoice(this, 'employment', 'self-employed')">
                        <div class="choice-title">Self-Employed / Freelancer</div>
                        <div class="choice-desc">Invoices & tax returns</div>
                    </div>
                    <div class="choice-card" onclick="selectChoice(this, 'employment', 'entrepreneur')">
                        <div class="choice-title">Entrepreneur</div>
                        <div class="choice-desc">Business owner</div>
                    </div>
                    <div class="choice-card" onclick="selectChoice(this, 'employment', 'remote')">
                        <div class="choice-title">Remote Worker</div>
                        <div class="choice-desc">Working from Rome</div>
                    </div>
                    <div class="choice-card" onclick="selectChoice(this, 'employment', 'student')">
                        <div class="choice-title">Student</div>
                        <div class="choice-desc">With parental guarantee</div>
                    </div>
                </div>

                <div class="input-group">
                    <input type="text" class="input-large" id="company" placeholder="Company or University" required>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn btn-primary" onclick="nextStep()" disabled>Continue</button>
                </div>
            </div>

            <!-- Step 5: Income & Payment -->
            <div class="step" data-step="5">
                <div class="step-number">Step 5 of 6</div>
                <h2 class="step-title">How will you cover the rent?</h2>
                <p class="step-subtitle">Choose what works best for your situation.</p>
                
                <div class="choices">
                    <div class="choice-card" onclick="selectIncomeType(this, 'own-income')">
                        <div class="choice-title">My Own Income</div>
                        <div class="choice-desc">Salary, freelance, business revenue</div>
                    </div>
                    <div class="choice-card" onclick="selectIncomeType(this, 'guarantor')">
                        <div class="choice-title">I Have a Guarantor</div>
                        <div class="choice-desc">Parent, partner, or sponsor will guarantee payment</div>
                    </div>
                    <div class="choice-card" onclick="selectIncomeType(this, 'upfront')">
                        <div class="choice-title">I Can Pay Upfront</div>
                        <div class="choice-desc">Pay 6-12 months in advance from savings</div>
                        <div class="choice-badge">Strongest position</div>
                    </div>
                </div>

                <!-- Own Income Section -->
                <div id="ownIncomeSection" style="display: none; margin-top: 32px;">
                    <div class="step-subtitle" style="margin-bottom: 24px;">What's your monthly net income?</div>
                    <div class="choices">
                        <div class="choice-card" onclick="selectChoice(this, 'income', '2000-3000')">
                            <div class="choice-title">€2,000 - €3,000</div>
                        </div>
                        <div class="choice-card" onclick="selectChoice(this, 'income', '3000-5000')">
                            <div class="choice-title">€3,000 - €5,000</div>
                        </div>
                        <div class="choice-card" onclick="selectChoice(this, 'income', '5000+')">
                            <div class="choice-title">€5,000+</div>
                        </div>
                    </div>
                    <div class="info-hint" id="incomeHint">
                        💡 <strong>Rule of thumb:</strong> Income should be 3x the rent.
                    </div>

                    <!-- Payment Frequency (for own income) -->
                    <div id="paymentFrequency" style="display: none; margin-top: 32px;">
                        <div class="step-subtitle" style="margin-bottom: 24px;">Preferred payment frequency?</div>
                        <div class="choices" id="paymentChoices">
                            <!-- Will be populated dynamically -->
                        </div>
                        <div class="info-hint">
                            💡 Paying quarterly or semi-annually = better terms. Lower deposit, potential rent discount.
                        </div>
                    </div>
                </div>

                <!-- Guarantor Section -->
                <div id="guarantorSection" style="display: none; margin-top: 32px;">
                    <div class="step-subtitle" style="margin-bottom: 24px;">Tell us about your guarantor (optional now, required later)</div>
                    <div class="input-group">
                        <input type="text" class="input-large" id="guarantorName" placeholder="Guarantor's full name">
                    </div>
                    <div class="input-group">
                        <input type="text" class="input-large" id="guarantorRelation" placeholder="Relationship (e.g., Parent, Partner)">
                    </div>
                    <div class="info-hint">
                        💡 Your guarantor will need to provide income proof and sign a guarantee document. You can provide their details now or during our call.
                    </div>

                    <!-- Payment Frequency (for guarantor) -->
                    <div id="paymentFrequencyGuarantor" style="margin-top: 32px;">
                        <div class="step-subtitle" style="margin-bottom: 24px;">Preferred payment frequency?</div>
                        <div class="choices" id="paymentChoicesGuarantor">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>
                </div>

                <!-- Upfront Section -->
                <div id="upfrontSection" style="display: none; margin-top: 32px;">
                    <div class="step-subtitle" style="margin-bottom: 24px;">How many months can you pay upfront?</div>
                    <div class="choices" id="upfrontChoices">
                        <!-- Will be populated dynamically -->
                    </div>
                    <div class="info-hint">
                        💡 Paying upfront = <strong>massive negotiation power</strong>. We can often secure 10-15% discount + minimal deposit.
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn btn-primary" onclick="nextStep()" disabled id="step5Continue">Continue</button>
                </div>
            </div>

            <!-- Step 6: Documents -->
            <div class="step" data-step="6">
                <div class="step-number">Step 6 of 6</div>
                <h2 class="step-title">Quick check: documents</h2>
                <p class="step-subtitle">These are needed to sign the contract. Missing something? We help.</p>
                
                <div class="checkbox-item" onclick="toggleCheckbox(this, 'passport')">
                    <div class="checkbox-custom"></div>
                    <div class="checkbox-label">Valid passport or ID</div>
                </div>
                <div class="checkbox-item" onclick="toggleCheckbox(this, 'codice')">
                    <div class="checkbox-custom"></div>
                    <div class="checkbox-label">Italian Codice Fiscale (or can get one)</div>
                </div>
                <div class="checkbox-item" onclick="toggleCheckbox(this, 'income-proof')">
                    <div class="checkbox-custom"></div>
                    <div class="checkbox-label">Proof of income (payslips, bank statements)</div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="prevStep()">Back</button>
                    <button class="btn btn-primary" onclick="submitForm()">Check Availability</button>
                </div>
            </div>
        </div>

        <!-- Success Screen -->
        <div class="success-screen" id="successScreen">
            <div class="success-icon">✓</div>
            <h2 class="success-title">We're on it</h2>
            <p class="success-text">
                Our team is checking if the apartment is available for your dates. 
                We'll contact you at <span class="success-email" id="confirmedEmail"></span>
            </p>
            <div class="success-time">Within 2 hours</div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 6;
        const formData = {};
        let apartmentData = {};

        // Parse URL parameters
        function parseURLParams() {
            const urlParams = new URLSearchParams(window.location.search);
            apartmentData = {
                name: urlParams.get('apt') || 'Rome Apartment',
                location: urlParams.get('location') || 'Rome',
                price: parseInt(urlParams.get('price')) || 1400,
                available: urlParams.get('available') || new Date().toISOString().split('T')[0]
            };

            // Update UI
            document.getElementById('apartmentTitle').textContent = apartmentData.name;
            document.getElementById('apartmentPrice').textContent = '€' + apartmentData.price.toLocaleString();
            
            // Set minimum date for move-in
            const availableDate = apartmentData.available;
            document.getElementById('moveInDate').setAttribute('min', availableDate);
            
            // Update income hint
            const requiredIncome = apartmentData.price * 3;
            document.getElementById('incomeHint').innerHTML = `💡 <strong>Rule of thumb:</strong> Income should be 3x the rent. For €${apartmentData.price}/month, that's €${requiredIncome.toLocaleString()}+ net.`;

            // Populate payment choices
            populatePaymentChoices();
        }

        function populatePaymentChoices() {
            const monthly = apartmentData.price;
            const quarterly = monthly * 3;
            const semiannual = monthly * 6;
            const threeMonths = monthly * 3;
            const sixMonths = monthly * 6;
            const twelveMonths = monthly * 12;

            // Own income payment options
            const paymentHTML = `
                <div class="choice-card" onclick="selectChoice(this, 'payment', 'monthly')">
                    <div class="choice-title">Monthly</div>
                    <div class="choice-desc">Standard payment</div>
                    <div class="choice-price">€${monthly.toLocaleString()}/month</div>
                </div>
                <div class="choice-card" onclick="selectChoice(this, 'payment', 'quarterly')">
                    <div class="choice-title">Quarterly</div>
                    <div class="choice-badge">Save 5-8%</div>
                    <div class="choice-desc">Better negotiation power</div>
                    <div class="choice-price">€${quarterly.toLocaleString()} every 3 months</div>
                </div>
                <div class="choice-card" onclick="selectChoice(this, 'payment', 'semiannual')">
                    <div class="choice-title">Semi-Annual</div>
                    <div class="choice-badge">Save up to 12%</div>
                    <div class="choice-desc">Maximum leverage</div>
                    <div class="choice-price">€${semiannual.toLocaleString()} every 6 months</div>
                </div>
            `;
            document.getElementById('paymentChoices').innerHTML = paymentHTML;

            // Guarantor payment options (monthly and quarterly only)
            const paymentGuarantorHTML = `
                <div class="choice-card" onclick="selectChoice(this, 'payment', 'monthly')">
                    <div class="choice-title">Monthly</div>
                    <div class="choice-desc">Standard payment</div>
                    <div class="choice-price">€${monthly.toLocaleString()}/month</div>
                </div>
                <div class="choice-card" onclick="selectChoice(this, 'payment', 'quarterly')">
                    <div class="choice-title">Quarterly</div>
                    <div class="choice-badge">Recommended</div>
                    <div class="choice-desc">Better terms with guarantor backing</div>
                    <div class="choice-price">€${quarterly.toLocaleString()} every 3 months</div>
                </div>
            `;
            document.getElementById('paymentChoicesGuarantor').innerHTML = paymentGuarantorHTML;

            // Upfront payment options
            const upfrontHTML = `
                <div class="choice-card" onclick="selectChoice(this, 'upfrontMonths', '3')">
                    <div class="choice-title">3 Months</div>
                    <div class="choice-desc">Good starting position</div>
                    <div class="choice-price">€${threeMonths.toLocaleString()} upfront</div>
                </div>
                <div class="choice-card" onclick="selectChoice(this, 'upfrontMonths', '6')">
                    <div class="choice-title">6 Months</div>
                    <div class="choice-desc">Strong negotiation position</div>
                    <div class="choice-price">€${sixMonths.toLocaleString()} upfront</div>
                    <div class="choice-badge">Popular choice</div>
                </div>
                <div class="choice-card" onclick="selectChoice(this, 'upfrontMonths', '12')">
                    <div class="choice-title">12 Months</div>
                    <div class="choice-desc">Maximum leverage for discounts</div>
                    <div class="choice-price">€${twelveMonths.toLocaleString()} upfront</div>
                    <div class="choice-badge">Best deal possible</div>
                </div>
            `;
            document.getElementById('upfrontChoices').innerHTML = upfrontHTML;
        }

        function updateProgress() {
            const progress = (currentStep / totalSteps) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }

        function showStep(stepNumber) {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.querySelector(`[data-step="${stepNumber}"]`).classList.add('active');
            currentStep = stepNumber;
            updateProgress();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function nextStep() {
            if (validateCurrentStep()) {
                showStep(currentStep + 1);
            }
        }

        function prevStep() {
            if (currentStep > 1) {
                showStep(currentStep - 1);
            }
        }

        function validateCurrentStep() {
            const step = document.querySelector(`[data-step="${currentStep}"]`);
            const inputs = step.querySelectorAll('input[required]');
            
            for (let input of inputs) {
                if (!input.value) {
                    input.focus();
                    return false;
                }
            }
            return true;
        }

        function selectChoice(element, key, value) {
            // Remove selection from siblings
            element.parentElement.querySelectorAll('.choice-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select this one
            element.classList.add('selected');
            formData[key] = value;
            
            // Special handling for income selection - show payment frequency
            if (key === 'income') {
                document.getElementById('paymentFrequency').style.display = 'block';
                document.getElementById('step5Continue').disabled = true;
                setTimeout(() => {
                    document.getElementById('paymentFrequency').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
                return;
            }
            
            // Enable continue button
            const step = element.closest('.step');
            const continueBtn = step.querySelector('.btn-primary');
            if (continueBtn) {
                continueBtn.disabled = false;
            }
        }

        function toggleCheckbox(element, key) {
            element.classList.toggle('checked');
            formData[key] = element.classList.contains('checked');
        }

        function selectIncomeType(element, type) {
            // Remove selection from siblings
            element.parentElement.querySelectorAll('.choice-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Select this one
            element.classList.add('selected');
            formData.incomeType = type;
            
            // Hide all sections first
            document.getElementById('ownIncomeSection').style.display = 'none';
            document.getElementById('guarantorSection').style.display = 'none';
            document.getElementById('upfrontSection').style.display = 'none';
            document.getElementById('paymentFrequency').style.display = 'none';
            document.getElementById('paymentFrequencyGuarantor').style.display = 'none';
            
            // Show relevant section
            if (type === 'own-income') {
                document.getElementById('ownIncomeSection').style.display = 'block';
                document.getElementById('step5Continue').disabled = true;
            } else if (type === 'guarantor') {
                document.getElementById('guarantorSection').style.display = 'block';
                document.getElementById('step5Continue').disabled = true;
            } else if (type === 'upfront') {
                document.getElementById('upfrontSection').style.display = 'block';
                document.getElementById('step5Continue').disabled = true;
            }

            setTimeout(() => {
                element.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
        }

        async function submitForm() {
            // Collect all form data
            formData.moveInDate = document.getElementById('moveInDate').value;
            formData.firstName = document.getElementById('firstName').value;
            formData.lastName = document.getElementById('lastName').value;
            formData.email = document.getElementById('email').value;
            formData.phone = document.getElementById('phone').value;
            formData.company = document.getElementById('company').value;
            
            // Income-specific data
            if (formData.incomeType === 'guarantor') {
                const guarantorName = document.getElementById('guarantorName').value;
                const guarantorRelation = document.getElementById('guarantorRelation').value;
                if (guarantorName) formData.guarantorName = guarantorName;
                if (guarantorRelation) formData.guarantorRelation = guarantorRelation;
            }
            
            formData.timestamp = new Date().toISOString();
            formData.apartment = apartmentData;

            const submitBtn = document.querySelector('[data-step="6"] .btn-primary');
            submitBtn.disabled = true;
            submitBtn.textContent = 'Sending...';

            try {
                // Build Web3Forms payload
                const web3FormData = new FormData();
                web3FormData.append('access_key', '5b10beba-c7e0-4cd2-98f9-2dbb0aefe889');
                web3FormData.append('subject', '🏠 New BOOM Application');
                web3FormData.append('from_name', 'BOOM Platform');
                
                // Apartment Info
                web3FormData.append('Apartment', apartmentData.name);
                web3FormData.append('Price', '€' + apartmentData.price);
                web3FormData.append('Location', apartmentData.location);
                
                // Personal Info
                web3FormData.append('Name', formData.firstName + ' ' + formData.lastName);
                web3FormData.append('Email', formData.email);
                web3FormData.append('Phone', formData.phone);
                
                // Move-in Details
                web3FormData.append('Move-in Date', formData.moveInDate);
                web3FormData.append('Duration', formData.duration);
                
                // Employment
                web3FormData.append('Employment', formData.employment);
                web3FormData.append('Company', formData.company);
                
                // Income & Payment
                web3FormData.append('Income Type', formData.incomeType);
                if (formData.income) web3FormData.append('Income Range', formData.income);
                if (formData.payment) web3FormData.append('Payment Frequency', formData.payment);
                if (formData.upfrontMonths) web3FormData.append('Upfront Months', formData.upfrontMonths);
                if (formData.guarantorName) web3FormData.append('Guarantor Name', formData.guarantorName);
                if (formData.guarantorRelation) web3FormData.append('Guarantor Relation', formData.guarantorRelation);
                
                // Documents
                web3FormData.append('Has Passport', formData.passport ? 'Yes' : 'No');
                web3FormData.append('Has Codice Fiscale', formData.codice ? 'Yes' : 'No');
                web3FormData.append('Has Income Proof', formData['income-proof'] ? 'Yes' : 'No');

                // Send to Web3Forms
                const response = await fetch('https://api.web3forms.com/submit', {
                    method: 'POST',
                    body: web3FormData
                });

                const data = await response.json();

                if (data.success) {
                    // Show success screen
                    document.getElementById('stepsContainer').style.display = 'none';
                    document.querySelector('.progress-bar').style.display = 'none';
                    document.getElementById('confirmedEmail').textContent = formData.email;
                    document.getElementById('successScreen').classList.add('active');
                    
                    console.log('✅ Application submitted successfully:', formData);
                } else {
                    throw new Error('Submission failed');
                }
                
            } catch (error) {
                alert('Something went wrong. Please try again or WhatsApp us at +39 331 325 1961');
                submitBtn.disabled = false;
                submitBtn.textContent = 'Check Availability';
                console.error('Error:', error);
            }
        }

        // Initialize on load
        parseURLParams();
        updateProgress();
    </script>
</body>
</html>