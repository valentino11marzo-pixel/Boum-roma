<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <title>BOOM ‚Äì Property Details</title>
    <meta name="robots" content="noindex,nofollow">
    <link rel="icon" type="image/png" href="https://www.boomrome.com/BOOMlogogoldicon512.png">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{--gold:#D4AF37;--gold-light:rgba(212,175,55,0.15);--bg:#000;--bg-card:#0A0A0A;--bg-elevated:#141414;--border:rgba(255,255,255,0.08);--text:#FFF;--text-secondary:#999;--text-muted:#666;--green:#34C759;--red:#FF3B30}
        body{font-family:'HelveticaNeue','Helvetica Neue','Helvetica',-apple-system,BlinkMacSystemFont,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;-webkit-font-smoothing:antialiased;font-weight:300}
        a{color:var(--gold);text-decoration:none}

        /* HEADER */
        .header{position:fixed;top:0;left:0;right:0;height:56px;background:rgba(0,0,0,0.85);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 20px;z-index:100}
        .header-logo{display:flex;align-items:center;gap:10px}
        .header-logo svg{width:28px;height:28px}
        .header-logo span{font-size:16px;font-weight:300;letter-spacing:4px}
        .header-badge{font-size:10px;color:var(--green);letter-spacing:1px;text-transform:uppercase;display:flex;align-items:center;gap:4px}

        /* GALLERY */
        .gallery{position:relative;width:100%;height:65vh;min-height:360px;max-height:560px;background:var(--bg-card);margin-top:56px;overflow:hidden}
        .gallery-track{display:flex;height:100%;transition:transform .4s ease}
        .gallery-slide{min-width:100%;height:100%;position:relative}
        .gallery-slide img{width:100%;height:100%;object-fit:cover}
        .gallery-placeholder{width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:12px;color:var(--text-muted);font-size:48px}
        .gallery-nav{position:absolute;top:50%;transform:translateY(-50%);width:44px;height:44px;background:rgba(0,0,0,0.5);backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,0.1);border-radius:50%;color:#fff;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s;z-index:10;border:none}
        .gallery-nav:hover{background:rgba(0,0,0,0.8);border-color:var(--gold)}
        .gallery-prev{left:16px}
        .gallery-next{right:16px}
        .gallery-counter{position:absolute;bottom:16px;right:16px;background:rgba(0,0,0,0.6);backdrop-filter:blur(8px);padding:6px 12px;border-radius:20px;font-size:12px;letter-spacing:1px;z-index:10}
        .gallery-dots{position:absolute;bottom:16px;left:50%;transform:translateX(-50%);display:flex;gap:6px;z-index:10}
        .gallery-dot{width:6px;height:6px;border-radius:50%;background:rgba(255,255,255,0.3);cursor:pointer;transition:all .2s}
        .gallery-dot.active{background:var(--gold);width:18px;border-radius:3px}
        .gallery-gradient{position:absolute;bottom:0;left:0;right:0;height:120px;background:linear-gradient(transparent,rgba(0,0,0,0.7));z-index:5;pointer-events:none}

        /* CONTENT */
        .content{max-width:720px;margin:0 auto;padding:0 20px}
        .price-section{padding:32px 0 24px}
        .price{font-size:40px;font-weight:300;letter-spacing:-1px}
        .price span{color:var(--text-secondary);font-size:18px;font-weight:300}
        .title{font-size:22px;font-weight:300;margin-top:8px;line-height:1.3}
        .zone{font-size:14px;color:var(--text-secondary);margin-top:6px;display:flex;align-items:center;gap:6px}

        /* STATS */
        .stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(100px,1fr));gap:1px;background:var(--border);border-radius:16px;overflow:hidden;margin-bottom:32px}
        .stat{background:var(--bg-card);padding:20px 16px;text-align:center}
        .stat-value{font-size:22px;font-weight:300;margin-bottom:4px}
        .stat-label{font-size:10px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1.5px}

        /* SECTIONS */
        .section{margin-bottom:32px}
        .section-title{font-size:11px;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:2px;margin-bottom:16px}
        .description{font-size:15px;line-height:1.7;color:var(--text-secondary);font-weight:300}

        /* FEATURES */
        .features{display:flex;flex-wrap:wrap;gap:8px}
        .feature{padding:8px 16px;background:var(--bg-elevated);border:1px solid var(--border);border-radius:20px;font-size:13px;font-weight:300;color:var(--text-secondary)}

        /* POIs */
        .poi-list{display:flex;flex-direction:column;gap:1px;background:var(--border);border-radius:12px;overflow:hidden}
        .poi{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;background:var(--bg-card);font-size:14px;font-weight:300}
        .poi-name{display:flex;align-items:center;gap:10px}
        .poi-icon{font-size:16px}
        .poi-dist{color:var(--text-muted);font-size:13px}

        /* MAP */
        .map-container{width:100%;height:280px;border-radius:16px;overflow:hidden;border:1px solid var(--border);margin-top:16px}
        #map{width:100%;height:100%}

        /* CTA */
        .cta-section{padding:40px 0;text-align:center}
        .cta-btn{display:inline-flex;align-items:center;gap:10px;padding:16px 40px;background:var(--gold);color:#000;border-radius:14px;font-family:inherit;font-size:15px;font-weight:600;letter-spacing:0.5px;text-decoration:none;transition:all .2s}
        .cta-btn:hover{transform:translateY(-2px);box-shadow:0 12px 32px rgba(212,175,55,0.3)}
        .cta-secondary{display:block;margin-top:16px;font-size:13px;color:var(--text-muted);font-weight:300}
        .cta-secondary a{color:var(--text-secondary)}

        /* STICKY CTA */
        .sticky-cta{position:fixed;bottom:0;left:0;right:0;background:rgba(0,0,0,0.9);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);border-top:1px solid var(--border);padding:12px 20px;display:flex;align-items:center;justify-content:space-between;z-index:100;transform:translateY(100%);transition:transform .3s ease}
        .sticky-cta.visible{transform:translateY(0)}
        .sticky-info{font-size:14px;font-weight:300}
        .sticky-info strong{color:var(--gold);font-weight:400}
        .sticky-btn{padding:10px 24px;background:var(--gold);color:#000;border-radius:10px;font-family:inherit;font-size:13px;font-weight:600;text-decoration:none;white-space:nowrap}

        /* FOOTER */
        .footer{border-top:1px solid var(--border);padding:32px 20px;text-align:center;margin-bottom:70px}
        .footer-brand{font-size:14px;font-weight:300;letter-spacing:4px;margin-bottom:8px;color:var(--text-secondary)}
        .footer-legal{font-size:11px;color:var(--text-muted);line-height:1.6}
        .footer-badge{display:inline-flex;align-items:center;gap:6px;padding:6px 14px;background:var(--gold-light);border:1px solid rgba(212,175,55,0.2);border-radius:20px;font-size:11px;color:var(--gold);margin-top:12px}

        /* LOADING/ERROR */
        .loading-state{min-height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:20px}
        .spinner{width:36px;height:36px;border:2px solid var(--border);border-top-color:var(--gold);border-radius:50%;animation:spin .8s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        .error-state{min-height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:16px;padding:40px;text-align:center}
        .error-state h2{font-weight:300;font-size:24px}
        .error-state p{color:var(--text-muted);font-size:14px;font-weight:300}

        /* RESPONSIVE */
        @media(max-width:640px){
            .gallery{height:50vh;min-height:280px}
            .price{font-size:32px}
            .price span{font-size:16px}
            .title{font-size:18px}
            .stats{grid-template-columns:repeat(2,1fr)}
            .gallery-nav{width:36px;height:36px;font-size:14px}
        }
    </style>
</head>
<body>

<div id="loading" class="loading-state">
    <div class="spinner"></div>
    <div style="font-size:13px;color:var(--text-muted);letter-spacing:2px">Loading...</div>
</div>

<div id="error" class="error-state" style="display:none">
    <div style="font-size:48px">üîó</div>
    <h2>Link not available</h2>
    <p>This property link may have expired or been removed.</p>
    <a href="https://www.boomrome.com/apartments.html" class="cta-btn" style="margin-top:16px">Browse Apartments</a>
</div>

<div id="page" style="display:none">

    <!-- HEADER -->
    <div class="header">
        <a href="https://www.boomrome.com" class="header-logo">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
                <defs><linearGradient id="goldGrad" x1="0%" y1="0%" x2="0%" y2="100%"><stop offset="0%" stop-color="#FFD54F"/><stop offset="100%" stop-color="#F5A623"/></linearGradient></defs>
                <g transform="translate(0,1024) scale(0.1,-0.1)" fill="url(#goldGrad)"><path d="M4860 8749 c-509 -29 -976 -161 -1413 -401 -580 -317 -1057 -806 -1350 -1383 -148 -292 -229 -532 -291 -859 -89 -465 -69 -1005 54 -1461 184 -688 616 -1308 1232 -1769 492 -368 1172 -609 1794 -635 546 -22 987 57 1489 267 503 211 979 589 1327 1053 340 453 557 994 630 1569 17 135 17 630 0 760 -93 716 -396 1341 -900 1861 -280 289 -569 498 -922 667 -416 200 -813 303 -1285 332 -165 10 -170 10 -365 -1z m610 -144 c743 -103 1436 -459 1919 -985 338 -367 562 -751 704 -1205 276 -879 132 -1858 -388 -2640 -242 -364 -493 -615 -900 -900 l-70 -49 109 104 c413 396 679 919 767 1505 33 217 33 558 0 765 -75 476 -257 896 -549 1265 -127 161 -363 380 -549 511 -300 211 -689 363 -1079 420 -172 26 -604 26 -764 0 -296 -47 -545 -128 -808 -262 -236 -122 -440 -271 -632 -464 -486 -485 -749 -1121 -751 -1815 -1 -611 170 -1148 515 -1608 100 -134 286 -335 382 -413 33 -27 -8 -2 -91 55 -513 351 -904 805 -1143 1331 -71 156 -136 336 -168 465 -9 33 -19 76 -24 95 -5 19 -20 100 -34 180 -59 343 -60 740 0 1070 81 456 229 826 479 1200 246 368 558 669 949 917 386 245 881 418 1321 462 61 6 124 13 140 15 73 10 556 -4 665 -19z"/></g>
            </svg>
            <span>BOOM</span>
        </a>
        <div class="header-badge">‚úì Verified</div>
    </div>

    <!-- GALLERY -->
    <div class="gallery" id="gallery">
        <div class="gallery-track" id="galleryTrack"></div>
        <button class="gallery-nav gallery-prev" id="galleryPrev" onclick="galleryGo(-1)">‚Äπ</button>
        <button class="gallery-nav gallery-next" id="galleryNext" onclick="galleryGo(1)">‚Ä∫</button>
        <div class="gallery-counter" id="galleryCounter"></div>
        <div class="gallery-dots" id="galleryDots"></div>
        <div class="gallery-gradient"></div>
    </div>

    <!-- CONTENT -->
    <div class="content">
        <div class="price-section">
            <div class="price" id="propPrice"></div>
            <div class="title" id="propTitle"></div>
            <div class="zone" id="propZone"></div>
        </div>

        <div class="stats" id="propStats"></div>

        <div class="section" id="descSection" style="display:none">
            <div class="section-title">Description</div>
            <div class="description" id="propDescription"></div>
        </div>

        <div class="section" id="featuresSection" style="display:none">
            <div class="section-title">Features</div>
            <div class="features" id="propFeatures"></div>
        </div>

        <div class="section" id="poisSection" style="display:none">
            <div class="section-title">Nearby</div>
            <div class="poi-list" id="propPois"></div>
            <div class="map-container" id="mapContainer" style="display:none">
                <div id="map"></div>
            </div>
        </div>

        <div class="cta-section">
            <a id="ctaWhatsapp" href="#" class="cta-btn" target="_blank">üí¨&nbsp; Contact on WhatsApp</a>
            <div class="cta-secondary">or <a href="https://www.boomrome.com/apartments.html">browse all apartments ‚Üí</a></div>
        </div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
        <div class="footer-brand">BOOM</div>
        <div class="footer-legal">Egidi Immobiliare S.r.l.<br><a href="https://www.boomrome.com">www.boomrome.com</a></div>
        <div class="footer-badge">üõ° Scam-Free Guarantee</div>
    </div>

    <!-- STICKY CTA -->
    <div class="sticky-cta" id="stickyCta">
        <div class="sticky-info" id="stickyInfo"></div>
        <a id="stickyBtn" href="#" class="sticky-btn" target="_blank">WhatsApp ‚Üí</a>
    </div>

</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
(function() {
    var FIREBASE_PROJECT = 'boom-property-dashboards';
    var FIREBASE_KEY = 'AIzaSyDDb8UeSc8RhO_VxQrhLrupu1aPD4rwRso';
    var WA_NUMBER = '393313251961';
    var galleryIndex = 0;

    var params = new URLSearchParams(window.location.search);
    var docId = params.get('id');
    if (!docId) { showError(); return; }

    var url = 'https://firestore.googleapis.com/v1/projects/' + FIREBASE_PROJECT + '/databases/(default)/documents/smartlinks/' + docId + '?key=' + FIREBASE_KEY;

    fetch(url)
        .then(function(r) { if (!r.ok) throw new Error(r.status); return r.json(); })
        .then(function(doc) {
            var d = parseDoc(doc.fields);
            if (!d.title) throw new Error('Empty');
            render(d);
        })
        .catch(function(e) { console.error(e); showError(); });

    function parseDoc(fields) {
        var d = {};
        for (var key in fields) {
            var val = fields[key];
            if (val.stringValue !== undefined) d[key] = val.stringValue;
            else if (val.integerValue !== undefined) d[key] = val.integerValue;
            else if (val.doubleValue !== undefined) d[key] = val.doubleValue;
            else if (val.booleanValue !== undefined) d[key] = val.booleanValue;
            else if (val.arrayValue) {
                d[key] = (val.arrayValue.values || []).map(function(v) {
                    if (v.stringValue !== undefined) return v.stringValue;
                    if (v.mapValue) {
                        var m = {};
                        for (var mk in v.mapValue.fields) {
                            var mv = v.mapValue.fields[mk];
                            m[mk] = mv.stringValue || mv.integerValue || '';
                        }
                        return m;
                    }
                    return v.stringValue || '';
                });
            }
        }
        return d;
    }

    function showError() {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'flex';
    }

    function esc(s) { var d = document.createElement('div'); d.textContent = s || ''; return d.innerHTML; }

    function render(d) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('page').style.display = 'block';
        document.title = (d.title || 'Property') + ' ‚Äì BOOM Rome';

        // Gallery
        var photos = d.photos || [];
        var track = document.getElementById('galleryTrack');
        var dots = document.getElementById('galleryDots');
        var counter = document.getElementById('galleryCounter');

        if (photos.length) {
            track.innerHTML = photos.map(function(u) {
                return '<div class="gallery-slide"><img src="' + esc(u) + '" alt="' + esc(d.title) + '" loading="lazy" onerror="this.parentElement.innerHTML=\'<div class=gallery-placeholder>üè†</div>\'"></div>';
            }).join('');
            dots.innerHTML = photos.map(function(_, i) {
                return '<div class="gallery-dot' + (i === 0 ? ' active' : '') + '" onclick="gallerySet(' + i + ')"></div>';
            }).join('');
            counter.textContent = '1 / ' + photos.length;
            if (photos.length <= 1) hideGalleryNav();
        } else {
            track.innerHTML = '<div class="gallery-slide"><div class="gallery-placeholder">üè†<div style="font-size:14px;letter-spacing:2px">BOOM ROME</div></div></div>';
            hideGalleryNav();
        }

        function hideGalleryNav() {
            document.getElementById('galleryPrev').style.display = 'none';
            document.getElementById('galleryNext').style.display = 'none';
            dots.style.display = 'none';
            counter.style.display = 'none';
        }

        // Price
        var price = d.price ? '‚Ç¨' + Number(d.price).toLocaleString('it-IT') : '';
        document.getElementById('propPrice').innerHTML = price ? price + ' <span>/month</span>' : '';

        // Title & Zone
        document.getElementById('propTitle').textContent = d.title || '';
        var zoneParts = [d.zone, d.address].filter(Boolean);
        document.getElementById('propZone').innerHTML = zoneParts.length ? 'üìç ' + esc(zoneParts.join(' ¬∑ ')) : '';

        // Stats
        var stats = [];
        if (d.rooms) stats.push({ v: d.rooms, l: 'Bedrooms' });
        if (d.bathrooms) stats.push({ v: d.bathrooms, l: 'Bathrooms' });
        if (d.size) stats.push({ v: d.size + 'm¬≤', l: 'Area' });
        stats.push({ v: '‚úì', l: 'Verified' });
        document.getElementById('propStats').innerHTML = stats.map(function(s) {
            return '<div class="stat"><div class="stat-value">' + esc(String(s.v)) + '</div><div class="stat-label">' + s.l + '</div></div>';
        }).join('');

        // Description
        if (d.description) {
            document.getElementById('descSection').style.display = 'block';
            document.getElementById('propDescription').textContent = d.description;
        }

        // Features
        var features = d.features || [];
        if (features.length) {
            document.getElementById('featuresSection').style.display = 'block';
            document.getElementById('propFeatures').innerHTML = features.map(function(f) {
                return '<div class="feature">' + esc(f) + '</div>';
            }).join('');
        }

        // POIs
        var pois = d.pois || [];
        if (pois.length) {
            document.getElementById('poisSection').style.display = 'block';
            var icons = { metro: 'üöá', bus: 'üöå', tram: 'üöä', shop: 'üõí', super: 'üõí', market: 'üõí', hospital: 'üè•', park: 'üå≥', uni: 'üéì', restaurant: 'üçΩ', bar: 'üç∏', gym: 'üí™', pharmacy: 'üíä', station: 'üöâ' };
            function getIcon(name) {
                var n = (name || '').toLowerCase();
                for (var k in icons) { if (n.indexOf(k) !== -1) return icons[k]; }
                return 'üìç';
            }
            document.getElementById('propPois').innerHTML = pois.map(function(p) {
                return '<div class="poi"><div class="poi-name"><span class="poi-icon">' + getIcon(p.name) + '</span> ' + esc(p.name) + '</div><div class="poi-dist">' + esc(p.distance) + '</div></div>';
            }).join('');
        }

        // Map
        var addr = [d.address, d.zone, 'Roma, Italia'].filter(Boolean).join(', ');
        if (addr && typeof L !== 'undefined') {
            fetch('https://nominatim.openstreetmap.org/search?format=json&q=' + encodeURIComponent(addr) + '&limit=1')
                .then(function(r) { return r.json(); })
                .then(function(res) {
                    if (!res.length) return;
                    var lat = parseFloat(res[0].lat), lon = parseFloat(res[0].lon);
                    document.getElementById('mapContainer').style.display = 'block';
                    var map = L.map('map', { zoomControl: false, attributionControl: false }).setView([lat, lon], 15);
                    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png').addTo(map);
                    L.marker([lat, lon], {
                        icon: L.divIcon({
                            className: '',
                            html: '<div style="width:32px;height:32px;background:#D4AF37;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:16px;box-shadow:0 4px 12px rgba(212,175,55,0.4)">üè†</div>',
                            iconSize: [32, 32], iconAnchor: [16, 16]
                        })
                    }).addTo(map);
                    setTimeout(function() { map.invalidateSize(); }, 200);
                }).catch(function() {});
        }

        // WhatsApp CTAs
        var waText = encodeURIComponent('Hi! I\'m interested in: ' + (d.title || 'this property') + (d.zone ? ' in ' + d.zone : '') + (price ? ' (' + price + '/mo)' : '') + '\n\nSent via BOOM SmartLink');
        var waUrl = 'https://wa.me/' + WA_NUMBER + '?text=' + waText;
        document.getElementById('ctaWhatsapp').href = waUrl;
        document.getElementById('stickyBtn').href = waUrl;
        document.getElementById('stickyInfo').innerHTML = '<strong>' + price + '</strong> ' + (d.zone ? '¬∑ ' + esc(d.zone) : '');

        // Sticky CTA on scroll
        var sticky = document.getElementById('stickyCta');
        window.addEventListener('scroll', function() {
            sticky.classList.toggle('visible', window.scrollY > 400);
        });

        // Touch swipe
        var gallery = document.getElementById('gallery');
        var startX = 0, startY = 0;
        gallery.addEventListener('touchstart', function(e) { startX = e.touches[0].clientX; startY = e.touches[0].clientY; }, { passive: true });
        gallery.addEventListener('touchend', function(e) {
            var dx = e.changedTouches[0].clientX - startX;
            var dy = Math.abs(e.changedTouches[0].clientY - startY);
            if (Math.abs(dx) > 50 && dy < 100) galleryGo(dx < 0 ? 1 : -1);
        }, { passive: true });

        // Auto-advance
        if (photos.length > 1) {
            var timer = setInterval(function() { galleryGo(1); }, 5000);
            gallery.addEventListener('touchstart', function() { clearInterval(timer); }, { once: true });
        }
    }

    // Gallery controls (global)
    window.galleryGo = function(dir) {
        var slides = document.querySelectorAll('.gallery-slide');
        if (!slides.length) return;
        galleryIndex = (galleryIndex + dir + slides.length) % slides.length;
        updateGallery();
    };
    window.gallerySet = function(i) { galleryIndex = i; updateGallery(); };

    function updateGallery() {
        document.getElementById('galleryTrack').style.transform = 'translateX(-' + (galleryIndex * 100) + '%)';
        var dots = document.querySelectorAll('.gallery-dot');
        for (var i = 0; i < dots.length; i++) dots[i].className = 'gallery-dot' + (i === galleryIndex ? ' active' : '');
        var total = document.querySelectorAll('.gallery-slide').length;
        document.getElementById('galleryCounter').textContent = (galleryIndex + 1) + ' / ' + total;
    }
})();
</script>
</body>
</html>
